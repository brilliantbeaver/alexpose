For the existing codebase in `ambient` and `server`, create comprehensive pytests, property-based tests, and integration tests to fully ensure quality of the implementation against what the requirements.md, design.md, and tasks.md specifications said.  Try not to create mocks for your tests to test the true implementation against real data and endpoints.  Systematically fix all root causes of test failures using simple and direct fixes first.  

All issues must be fixed before you continue.  Proceed carefully and thoughtfully creating and running these tests.F